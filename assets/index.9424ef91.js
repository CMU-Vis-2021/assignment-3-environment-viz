import*as e from"https://unpkg.com/d3?module";const U=function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))u(a);new MutationObserver(a=>{for(const n of a)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&u(h)}).observe(document,{childList:!0,subtree:!0});function c(a){const n={};return a.integrity&&(n.integrity=a.integrity),a.referrerpolicy&&(n.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?n.credentials="include":a.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function u(a){if(a.ep)return;a.ep=!0;const n=c(a);fetch(a.href,n)}};U();var R=650,F=400,m=450,x=250,l={top:20,right:30,bottom:100,left:130},y="2000",B=["#7c0202","#b64d24","#b86213","#e18820","#de9b10","#f3c523","#7c5201","#fac45a","#fd860b","#ffdc6c","#ff4901","#a43407"],z=["0","1","2","3","4","5","6","7","8","9","10","11"],N=1,b=26e4,S=e.geoMercator().center([-96,37]).scale(588).translate([R/2,F/2]),v=e.select("#my_dataviz").append("div").attr("class","tooltip").style("opacity",0).style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px"),i=e.select("#my_dataviz").append("svg").attr("width",R).attr("height",F),A=e.scaleOrdinal().domain(z).range(B),s=e.scaleLinear().domain([N,b]).range([2,25]);e.csv("assets/firesfinaldata.csv").then(I=>{e.json("assets/geojson/USA.geojson").then(function(g){i.append("g").selectAll("path").data(g.features).enter().append("path").attr("fill","#b8b8b8").attr("d",e.geoPath().projection(S)).style("stroke","black").style("opacity",.3),i.selectAll("myCircles").data(I).enter().append("circle").attr("class",t=>"year"+t.FIRE_YEAR+" dataCircles val"+t.VALUE+""+t.FIRE_YEAR).attr("cx",function(t){return S([t.LONGITUDE,t.LATITUDE])[0]}).attr("cy",function(t){return S([t.LONGITUDE,t.LATITUDE])[1]}).attr("r",function(t){return s(t.FIRE_SIZE)}).style("fill",function(t){return A(t.VALUE)}).attr("stroke",function(t){return A(t.VALUE)}).attr("stroke-width",3).attr("fill-opacity",.4).on("mouseover",function(t,o){v.style("opacity",1),v.style("display","block")}).on("mousemove",function(t,o){v.html("Fire year: "+o.FIRE_YEAR+"<br>Acres burned: "+o.FIRE_SIZE+"<br>Cause of fire: "+o.NWCG_GENERAL_CAUSE+"<br>State: "+o.STATE+"<br>County: "+o.FIPS_NAME).style("left",t.x+30+"px").style("top",t.y-30+"px")}).on("mouseleave",function(t,o){v.style("opacity",0),v.style("display","none")}),e.select("#my_dataviz").append("svg").attr("width",R).attr("height",60);var c=e.select("#my_dataviz").append("svg").attr("width",m+l.left+l.right).attr("height",x+l.top+l.bottom).attr("class","overflow-viz").append("g").attr("transform","translate("+l.left+","+l.top+")"),u=e.scaleLinear().range([0,m]);const a=c.append("g").attr("transform","translate(0,"+x+")");var n=e.scaleBand().range([0,x]).padding(.1);const h=c.append("g");c.append("text").attr("x",m/2-35).attr("y",0-l.top*2.5).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text("Human-made fires by cause"),c.append("text").attr("x",m/2-35).attr("y",0-l.top*1.3).attr("text-anchor","middle").style("font-size","14px").style("color","grey").style("opacity",".6").text("Click on bar to focus"),c.append("text").attr("x",m/2).attr("y",x+l.top*2.4).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text("Fire acres");function _(t){let o=I.filter(function(r){return r.FIRE_YEAR==t});n.domain(o.map(function(r){return r.NWCG_GENERAL_CAUSE})),h.transition().duration(1e3).call(e.axisLeft(n)),u.domain([0,e.max(o,function(r){return parseInt(r.FIRE_SIZE)})]),a.transition().duration(1e3).call(e.axisBottom(u));var d=c.selectAll("rect").data(o);d.join("rect").transition().duration(1e3).attr("class",function(r){return"fire"+r.FIRE_SIZE}).attr("x",u(0)).attr("y",r=>n(r.NWCG_GENERAL_CAUSE)).attr("width",r=>u(r.FIRE_SIZE)).attr("height",n.bandwidth()).style("fill",function(r){return A(r.VALUE)}).attr("stroke",function(r){return A(r.VALUE)}).attr("stroke-width",3)}_(2e3);function w(){e.selectAll(".slider").each(function(t){let d=e.select(this).property("value"),r="year"+d;y=d,_(y);let p=document.getElementsByClassName("button");for(let f=0;f<=p.length-1;f++)p[f].classList.remove("active");i.selectAll(".dataCircles").transition().duration(1e3).style("opacity",0).attr("r",0),i.selectAll("."+r).transition().duration(1e3).style("opacity",1).attr("r",function(f){return s(f.FIRE_SIZE)})})}function T(t){e.selectAll(".checkbox").each(function(o){let d=e.select(this);console.log(d);let r=d.property("value"),p="val"+r;console.log("group"),console.log(p),console.log("map year"),console.log(y),d.property("checked")?(console.log("SELECTED","."+p+""+y),i.selectAll("."+p+""+y).transition().duration(1e3).style("opacity",1).attr("r",function(f){return s(f.FIRE_SIZE)})):(console.log("NOT SELECTED"),i.selectAll("."+p+""+y).transition().duration(1e3).style("opacity",0).attr("r",0))})}e.selectAll(".slider").on("change",w),e.selectAll(".checkbox").on("change",T),w();var L=[N,b/2,b],k=50,C=100,E=380;i.selectAll("legend").data(L).enter().append("circle").attr("cx",k).attr("cy",function(t){return E-s(t)}).attr("r",function(t){return s(t)}).style("fill","none").attr("stroke","black"),i.selectAll("legend").data(L).enter().append("line").attr("x1",function(t){return k+s(t)}).attr("x2",C).attr("y1",function(t){return E-s(t)*1.5}).attr("y2",function(t){return E-s(t)*1.5}).attr("stroke","black").style("stroke-dasharray","2,2"),i.selectAll("legend").data(L).enter().append("text").attr("x",C).attr("y",function(t){return E-s(t)*1.5}).text(function(t){return t==b?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" acres":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}).style("font-size",12).attr("alignment-baseline","middle")})});var G=document.getElementById("yearShown");myRange.oninput=function(){G.innerHTML=this.value};
