import*as r from"https://unpkg.com/d3?module";const z=function(){const y=document.createElement("link").relList;if(y&&y.supports&&y.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function f(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=f(a);fetch(a.href,l)}};z();var L=650,k=400,g=450,A=250,i={top:20,right:30,bottom:100,left:130};let I="";var E="2000",O=["#7c0202","#b64d24","#b86213","#e18820","#de9b10","#f3c523","#7c5201","#fac45a","#fd860b","#ffdc6c","#ff4901","#a43407"],G=["#edc4c4","#c3a599","#dfc4ab","#efc493","#e7d6b5","#f7e5a6","#cfc8bb","#fce8c0","#ffbb76","#fff1c3","#fa976f","#a16851"],N=["0","1","2","3","4","5","6","7","8","9","10","11"],B=1,b=26e4,S=r.geoMercator().center([-96,37]).scale(588).translate([L/2,k/2]),v=r.select("#my_dataviz").append("div").attr("class","tooltip").style("opacity",0).style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px"),s=r.select("#my_dataviz").append("svg").attr("width",L).attr("height",k),h=r.scaleOrdinal().domain(N).range(O),D=r.scaleOrdinal().domain(N).range(G),u=r.scaleLinear().domain([B,b]).range([2,25]);r.csv("assets/firesfinaldata.csv").then(R=>{r.json("assets/geojson/USA.geojson").then(function(y){let f=R.filter(t=>t.STATE!="AK");f=f.filter(t=>t.STATE!="HI"),console.log(f),s.append("g").selectAll("path").data(y.features).enter().append("path").attr("fill","#b8b8b8").attr("d",r.geoPath().projection(S)).style("stroke","black").style("opacity",.3),s.selectAll("myCircles").data(f).enter().append("circle").attr("class",t=>"year"+t.FIRE_YEAR+" dataCircles val"+t.VALUE+""+t.FIRE_YEAR).attr("cx",function(t){return S([t.LONGITUDE,t.LATITUDE])[0]}).attr("cy",function(t){return S([t.LONGITUDE,t.LATITUDE])[1]}).attr("r",function(t){return u(t.FIRE_SIZE)}).style("fill",function(t){return h(t.VALUE)}).attr("stroke",function(t){return h(t.VALUE)}).attr("stroke-width",3).attr("fill-opacity",.4).on("mouseover",function(t,n){v.style("opacity",1),v.style("display","block")}).on("mousemove",function(t,n){v.html("Fire year: "+n.FIRE_YEAR+"<br>Acres burned: "+n.FIRE_SIZE+"<br>Cause of fire: "+n.NWCG_GENERAL_CAUSE+"<br>State: "+n.STATE+"<br>County: "+n.FIPS_NAME).style("left",t.x+30+"px").style("top",t.y-30+"px")}).on("mouseleave",function(t,n){v.style("opacity",0),v.style("display","none")}),r.select("#my_dataviz").append("svg").attr("width",L).attr("height",60);var o=r.select("#my_dataviz").append("svg").attr("width",g+i.left+i.right).attr("height",A+i.top+i.bottom).attr("class","overflow-viz").append("g").attr("transform","translate("+i.left+","+i.top+")"),a=r.scaleLinear().range([0,g]);const l=o.append("g").attr("transform","translate(0,"+A+")");var c=r.scaleBand().range([0,A]).padding(.1);const F=o.append("g");o.append("text").attr("x",g/2-35).attr("y",0-i.top*2.5).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text("Human-made fires by cause"),o.append("text").attr("x",g/2-35).attr("y",0-i.top*1.3).attr("text-anchor","middle").style("font-size","14px").style("color","grey").style("opacity",".6").text("Click on bar to focus"),o.append("text").attr("x",g/2).attr("y",A+i.top*2.4).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text("Fire acres");function _(t){let n=f.filter(function(e){return e.FIRE_YEAR==t});c.domain(n.map(function(e){return e.NWCG_GENERAL_CAUSE})),F.transition().duration(1e3).call(r.axisLeft(c)),a.domain([0,r.max(n,function(e){return parseInt(e.FIRE_SIZE)})]),l.transition().duration(1e3).call(r.axisBottom(a));var p=o.selectAll("rect").data(n);p.join("rect").transition().duration(1e3).attr("x",a(0)).attr("x",a(0)).attr("class",function(e){return"val"+e.VALUE+"bar bars"}).attr("y",e=>c(e.NWCG_GENERAL_CAUSE)).attr("width",e=>a(e.FIRE_SIZE)).attr("height",c.bandwidth()).style("fill",function(e){return h(e.VALUE)}),r.selectAll("rect").on("mousedown",function(e,d){V(),this.classList.add("active"),I=""}),r.selectAll("rect").on("mouseup",w)}_(2e3);function V(){let t=document.getElementsByClassName("bars");for(let n=0;n<=t.length-1;n++)t[n].classList.remove("active")}function T(){r.selectAll(".slider").each(function(t){let p=r.select(this).property("value"),e="year"+p;E=p,_(E),s.selectAll(".dataCircles").transition().duration(1e3).style("opacity",0).attr("r",0),s.selectAll("."+e).transition().duration(1e3).style("opacity",1).attr("r",function(d){return u(d.FIRE_SIZE)})})}function w(t){r.selectAll("rect").each(function(n){r.select(this);let p=n.VALUE,e="val"+p;this.classList.contains("active")!=!0&&I!=e?(s.selectAll("."+e+""+E).transition().duration(1e3).style("opacity",.3).style("stroke",function(d){return h(d.VALUE)}).attr("fill-opacity",.4),o.selectAll("."+e+"bar").transition().duration(1e3).style("fill",function(d){return D(d.VALUE)})):(console.log("ACTIVE BUTTON DETECTED"),console.log(e+"bar"),console.log(e+"bar"),I=e,s.selectAll("."+e+""+E).transition().duration(1e3).style("opacity",1).style("stroke","black").attr("fill-opacity",.8),o.selectAll("."+e+"bar").transition().duration(1e3).style("fill",function(d){return h(d.VALUE)}))})}r.selectAll(".slider").on("change",T),r.selectAll(".checkbox").on("change",w),T();var x=[B,b/2,b],C=50,U=100,m=380;s.selectAll("legend").data(x).enter().append("circle").attr("cx",C).attr("cy",function(t){return m-u(t)}).attr("r",function(t){return u(t)}).style("fill","none").attr("stroke","black"),s.selectAll("legend").data(x).enter().append("line").attr("x1",function(t){return C+u(t)}).attr("x2",U).attr("y1",function(t){return m-u(t)*1.5}).attr("y2",function(t){return m-u(t)*1.5}).attr("stroke","black").style("stroke-dasharray","2,2"),s.selectAll("legend").data(x).enter().append("text").attr("x",U).attr("y",function(t){return m-u(t)*1.5}).text(function(t){return t==b?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" acres":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}).style("font-size",12).attr("alignment-baseline","middle")})});var j=document.getElementById("yearShown");myRange.oninput=function(){j.innerHTML=this.value};
