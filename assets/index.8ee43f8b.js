import*as a from"https://unpkg.com/d3?module";const J=function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))s(l);new MutationObserver(l=>{for(const c of l)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&s(m)}).observe(document,{childList:!0,subtree:!0});function A(l){const c={};return l.integrity&&(c.integrity=l.integrity),l.referrerpolicy&&(c.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?c.credentials="include":l.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function s(l){if(l.ep)return;l.ep=!0;const c=A(l);fetch(l.href,c)}};J();var E=650,C=400,v=450,S=250,p={top:20,right:30,bottom:100,left:130};let N="";var T=!1,h="2000",X=["#7c0202","#b64d24","#b86213","#e18820","#de9b10","#f3c523","#7c5201","#fac45a","#fd860b","#ffdc6c","#ff4901","#a43407"],Y=["#edc4c4","#c3a599","#dfc4ab","#efc493","#e7d6b5","#f7e5a6","#cfc8bb","#fce8c0","#ffbb76","#fff1c3","#fa976f","#a16851"],B=["0","1","2","3","4","5","6","7","8","9","10","11"],Y=["#edc4c4","#c3a599","#dfc4ab","#efc493","#e7d6b5","#f7e5a6","#cfc8bb","#fce8c0","#ffbb76","#fff1c3","#fa976f","#a16851"],j={Alabama:"AL",Alaska:"AK",Arizona:"AZ",Arkansas:"AR",California:"CA",Colorado:"CO",Connecticut:"CT",Delaware:"DE",Florida:"FL",Georgia:"GA",Hawaii:"HI",Idaho:"ID",Illinois:"IL",Indiana:"IN",Iowa:"IA",Kansas:"KS",Kentucky:"KY",Louisiana:"LA",Maine:"ME",Maryland:"MD",Massachusetts:"MA",Michigan:"MI",Minnesota:"MN",Mississippi:"MS",Missouri:"MO",Montana:"MT",Nebraska:"NE",Nevada:"NV","New Hampshire":"NH","New Jersey":"NJ","New Mexico":"NM","New York":"NY","North Carolina":"NC","North Dakota":"ND",Ohio:"OH",Oklahoma:"OK",Oregon:"OR",Pennsylvania:"PA","Rhode Island":"RI","South Carolina":"SC","South Dakota":"SD",Tennessee:"TN",Texas:"TX",Utah:"UT",Vermont:"VT",Virgina:"VA",Washington:"WA","West Virginia":"WV",Wisconsin:"WI",Wyoming:"WY"},Q=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"],b={Alabama:[-82,30,1e3],Alaska:[-147,60,400],Arizona:[-107,30,1e3],Arkansas:[-87,31,1e3],California:[-113,34,1e3],Colorado:[-100,35,1e3],Connecticut:[-70,40,2e3],Delaware:[-74,38,3e3],Florida:[-80,26,1300],Georgia:[-79,30,1e3],Hawaii:[-155,19,2e3],Idaho:[-111,43,1e3],Illinois:[-84,38,1300],Indiana:[-84,38,1300],Iowa:[-91,40,1300],Kansas:[-96,37,1300],Kentucky:[-82,35,1300],Louisiana:[-89,30,1300],Maine:[-66,44,1300],Maryland:[-74,37,1500],Massachusetts:[-69,41,1900],Michigan:[-83,43,1300],Minnesota:[-92,45,1300],Mississippi:[-86,30,1300],Missouri:[-90,37,1400],Montana:[-107,46,1300],Nebraska:[-98,40,1300],Nevada:[-115,35,1e3],"New Hampshire":[-69,43,1700],"New Jersey":[-72,38,1900],"New Mexico":[-103,30,1e3],"New York":[-73,41,1400],"North Carolina":[-77,33,1300],"North Dakota":[-99,46,1300],Ohio:[-81,39,1700],Oklahoma:[-95,34,1400],Oregon:[-119,43,1300],Pennsylvania:[-76,40,1600],"Rhode Island":[-70,41,3500],"South Carolina":[-79,32,1600],"South Dakota":[-99,43,1400],Tennessee:[-82,34,1700],Texas:[-93,29,1e3],Utah:[-110,37,1400],Vermont:[-71,43,1800],Virginia:[-78,36,1500],Washington:[-118,46,1300],"West Virginia":[-79,37,1500],Wisconsin:[-88,43,1400],Wyoming:[-106,42,1300]},P=1,k=26e4,R=a.geoMercator().center([-96,37]).scale(588).translate([E/2,C/2]),L=a.select("#my_dataviz").append("div").attr("class","tooltip").style("opacity",0).style("background-color","white").style("border","solid").style("border-width","2px").style("border-radius","5px").style("padding","5px"),u=a.select("#my_dataviz").append("svg").attr("width",E).attr("height",C),d=a.scaleOrdinal().domain(B).range(X),tt=a.scaleOrdinal().domain(B).range(Y),y=a.scaleLinear().domain([P,k]).range([2,25]);a.csv("assets/firesfinaldata.csv").then(M=>{a.json("assets/geojson/USA.geojson").then(function(g){let A=M.filter(t=>t.STATE!="AK");A=A.filter(t=>t.STATE!="HI"),u.append("g").selectAll("path").data(g.features).enter().append("path").attr("fill","#b8b8b8").attr("d",a.geoPath().projection(R)).style("stroke","black").style("opacity",.3),u.selectAll("myCircles").data(A).enter().append("circle").attr("class",t=>"year"+t.FIRE_YEAR+" dataCircles val"+t.VALUE+""+t.FIRE_YEAR).attr("cx",function(t){return R([t.LONGITUDE,t.LATITUDE])[0]}).attr("cy",function(t){return R([t.LONGITUDE,t.LATITUDE])[1]}).attr("r",function(t){return y(t.FIRE_SIZE)}).style("fill",function(t){return d(t.VALUE)}).attr("stroke",function(t){return d(t.VALUE)}).attr("stroke-width",3).attr("fill-opacity",.4).on("mouseover",function(t,r){L.style("opacity",1),L.style("display","block")}).on("mousemove",function(t,r){L.html("Fire year: "+r.FIRE_YEAR+"<br>Acres burned: "+r.FIRE_SIZE+"<br>Cause of fire: "+r.NWCG_GENERAL_CAUSE+"<br>State: "+r.STATE+"<br>County: "+r.FIPS_NAME).style("left",t.x+30+"px").style("top",t.y-30+"px")}).on("mouseleave",function(t,r){L.style("opacity",0),L.style("display","none")}),a.select("#my_dataviz").append("svg").attr("width",E).attr("height",60);var s=a.select("#my_dataviz").append("svg").attr("width",v+p.left+p.right).attr("height",S+p.top+p.bottom).attr("class","overflow-viz").append("g").attr("transform","translate("+p.left+","+p.top+")"),l=a.scaleLinear().range([0,v]),c=s.append("g").attr("transform","translate(0,"+S+")"),m=a.scaleBand().range([0,S]).padding(.1);const K=s.append("g");s.append("text").attr("x",v/2-35).attr("y",0-p.top*2.5).attr("text-anchor","middle").style("font-size","16px").style("font-weight","bold").text("Human-made fires by cause"),s.append("text").attr("x",v/2-35).attr("y",0-p.top*1.3).attr("text-anchor","middle").style("font-size","14px").style("color","grey").style("opacity",".6").text("Click on bar to focus. Click again to undo."),s.append("text").attr("x",v/2).attr("y",S+p.top*3.4).attr("text-anchor","middle").style("font-size","12px").style("font-weight","bold").text("Cumulative Number of acres burned by fires");function V(t){let r=A.filter(function(e){return e.FIRE_YEAR==t});m.domain(r.map(function(e){return e.NWCG_GENERAL_CAUSE})),K.transition().duration(1e3).call(a.axisLeft(m));var o=[];r.reduce(function(e,i){return e[i.NWCG_GENERAL_CAUSE]||(e[i.NWCG_GENERAL_CAUSE]={NWCG_GENERAL_CAUSE:i.NWCG_GENERAL_CAUSE,VALUE:i.VALUE,qty:0},o.push(e[i.NWCG_GENERAL_CAUSE])),e[i.NWCG_GENERAL_CAUSE].qty+=parseInt(i.FIRE_SIZE),e},{}),l.domain([0,a.max(o,function(e){return parseInt(e.qty)})]),c.transition().duration(1e3).call(a.axisBottom(l)).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"});var f=s.selectAll("rect").data(o);f.join("rect").transition().duration(1e3).attr("x",l(0)).attr("x",l(0)).attr("class",function(e){return"val"+e.VALUE+"bar bars"}).attr("y",e=>m(e.NWCG_GENERAL_CAUSE)).attr("width",e=>l(parseInt(e.qty))).attr("height",m.bandwidth()).style("fill",function(e){return d(e.VALUE)}),a.selectAll("rect").on("mousedown",function(e,i){q(),this.classList.add("active"),console.log(N),console.log(i.VALUE),N=="val"+i.VALUE&&(T=!0),N=""}),a.selectAll("rect").on("mouseup",D)}V(2e3);function q(){let t=document.getElementsByClassName("bars");for(let r=0;r<=t.length-1;r++)t[r].classList.remove("active")}function F(){a.selectAll(".slider").each(function(t){let o=a.select(this).property("value"),f="year"+o;h=o,V(h),u.selectAll(".dataCircles").transition().duration(1e3).style("opacity",0).attr("r",0),u.selectAll("."+f).transition().duration(1e3).style("opacity",1).attr("r",function(e){return y(e.FIRE_SIZE)})})}function D(t,r){T==!0?(a.selectAll("rect").each(function(o){a.select(this);let f=o.VALUE,e="val"+f;u.selectAll("."+e+""+h).transition().duration(1e3).style("opacity",1).attr("fill-opacity",.8),s.selectAll("."+e+"bar").transition().duration(1e3).style("fill",function(i){return d(i.VALUE)}),u.selectAll("."+e+""+h).transition().duration(1e3).style("opacity",1).style("stroke",function(i){return d(i.VALUE)}).attr("fill-opacity",.4),s.selectAll("."+e+"bar").transition().duration(1e3).style("stroke","none").style("fill",function(i){return d(i.VALUE)})}),T=!1):a.selectAll("rect").each(function(o){a.select(this);let f=o.VALUE,e="val"+f;this.classList.contains("active")!=!0&&N!=e?(u.selectAll("."+e+""+h).transition().duration(1e3).style("opacity",.3).style("stroke",function(i){return d(i.VALUE)}).attr("fill-opacity",.4),s.selectAll("."+e+"bar").transition().duration(1e3).style("stroke","none").style("fill",function(i){return tt(i.VALUE)})):(N=e,u.selectAll("."+e+""+h).transition().duration(1e3).style("opacity",1).style("stroke","black").attr("fill-opacity",.8),s.selectAll("."+e+"bar").transition().duration(1e3).style("fill",function(i){return d(i.VALUE)}))}),console.log(T)}a.selectAll(".slider").on("change",F),a.selectAll(".checkbox").on("change",D),F();var U=[P,k/2,k],O=50,W=100,I=380;u.selectAll("legend").data(U).enter().append("circle").attr("cx",O).attr("cy",function(t){return I-y(t)}).attr("r",function(t){return y(t)}).style("fill","none").attr("stroke","black"),u.selectAll("legend").data(U).enter().append("line").attr("x1",function(t){return O+y(t)}).attr("x2",W).attr("y1",function(t){return I-y(t)*1.5}).attr("y2",function(t){return I-y(t)*1.5}).attr("stroke","black").style("stroke-dasharray","2,2"),u.selectAll("legend").data(U).enter().append("text").attr("x",W).attr("y",function(t){return I-y(t)*1.5}).text(function(t){return t==k?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")+" acres":t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}).style("font-size",12).attr("alignment-baseline","middle");var x=a.select("#state").append("svg").attr("width",400).attr("height",300);a.select("#stateSelect").selectAll("myStates").data(Q).enter().append("option").text(function(t){return t}).attr("value",function(t){return t});let Z=document.getElementById("stateSelect");Z.value="Texas";var w=a.geoMercator().center([b.Texas[0],b.Texas[1]]).scale(b.Texas[2]).translate([E/2,C/2]);state.features=g.features.filter(function(t){return t.properties.NAME=="Texas"}),x.selectAll("path").data(state.features).join("path").transition().duration(1e3).attr("fill","#b8b8b8").attr("d",a.geoPath().projection(w)).style("stroke","black").style("opacity",.3);let _=document.querySelector("#hover_Text");_.innerHTML="Year of Fire: <br> Cause of Fire: <br> Number of acres burned: <br>Location of Fire:";function $(t){return t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function z(t){if(!t){_.innerHTML="Year of Fire: <br> Cause of Fire: <br> Number of acres burned: <br>Location of Fire:";return}_.innerHTML=`Year of Fire: ${t.year} <br>
      Cause of Fire: ${t.cause} <br> 
      Number of acres burned: ${$(t.acres)} 
      <br>
      Location of Fire: ${t.county}, ${t.state}`}x.selectAll("myCircles").data(M).join("circle").attr("class",t=>"state"+t.STATE).attr("cx",function(t){return w([t.LONGITUDE,t.LATITUDE])[0]}).attr("cy",function(t){return w([t.LONGITUDE,t.LATITUDE])[1]}).attr("r",0).style("fill",function(t){return d(t.VALUE)}).attr("stroke",function(t){return d(t.VALUE)}).attr("stroke-width",3).attr("fill-opacity",.4).on("mouseover",function(t,r){z({acres:r.FIRE_SIZE,state:r.STATE,year:r.FIRE_YEAR,county:r.FIPS_NAME,cause:r.NWCG_GENERAL_CAUSE})}).on("mouseout",function(t){z()});var G="Texas";function H(t){state.features=g.features.filter(function(e){return e.properties.NAME==t});var r=a.geoMercator().center([b[t][0],b[t][1]]).scale(b[t][2]).translate([E/2,C/2]);x.selectAll("path").data(state.features).join("path").transition().duration(1e3).attr("fill","#b8b8b8").attr("d",a.geoPath().projection(r)).style("stroke","black").style("opacity",.3);var o=document.getElementById("stateSelect");o.value;let f=j[t];x.selectAll("myCircles").attr("class",e=>"state"+e.STATE).attr("r",0).style("fill",function(e){return d(e.VALUE)}).attr("stroke",function(e){return d(e.VALUE)}).attr("stroke-width",3).attr("fill-opacity",.4),x.selectAll(".state"+f).attr("cx",function(e){return r([e.LONGITUDE,e.LATITUDE])[0]}).attr("cy",function(e){return r([e.LONGITUDE,e.LATITUDE])[1]}).transition().duration(1e3).style("opacity",1).attr("r",function(e){return y(e.FIRE_SIZE)})}H("Texas"),a.select("#stateSelect").on("change",function(t,r){x.selectAll(".state"+j[G]).transition().duration(1e3).style("opacity",0).attr("r",0);const o=a.select(this).property("value");G=o,H(o)});let n=a.select("#legend").attr("class","overflow-viz");n.append("circle").attr("cx",20).attr("cy",20).attr("r",8).style("fill","#7c0202"),n.append("text").attr("x",30).attr("y",20).text("Missing data/not specified/undetermined").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",50).attr("r",8).style("fill","#b64d24"),n.append("text").attr("x",30).attr("y",50).text("Debris and open burning").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",80).attr("r",8).style("fill","#b86213"),n.append("text").attr("x",30).attr("y",80).text("Arson/incendiarism").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",110).attr("r",8).style("fill","#b86213"),n.append("text").attr("x",30).attr("y",110).text("Equipment and vehicle use").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",140).attr("r",8).style("fill","#de9b10"),n.append("text").attr("x",30).attr("y",140).text("Recreation and ceremony").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",170).attr("r",8).style("fill","#f3c523"),n.append("text").attr("x",30).attr("y",170).text("Misuse of fire by a minor").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",200).attr("r",8).style("fill","#7c5201"),n.append("text").attr("x",30).attr("y",200).text("Smoking").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",290).attr("r",8).style("fill","#ffdc6c"),n.append("text").attr("x",30).attr("y",290).text("Fireworks").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",230).attr("r",8).style("fill","#ff4901"),n.append("text").attr("x",30).attr("y",230).text("Other causes").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",260).attr("r",8).style("fill","#a43407"),n.append("text").attr("x",30).attr("y",260).text("Firearms and explosives use").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",320).attr("r",8).style("fill","#fac45a"),n.append("text").attr("x",30).attr("y",320).text("Railroad operations and maintenance").style("font-size","15px").attr("alignment-baseline","middle"),n.append("circle").attr("cx",20).attr("cy",350).attr("r",8).style("fill","#fd860b"),n.append("text").attr("x",30).attr("y",350).text("Power generation/transmission/distribution").style("font-size","15px").attr("alignment-baseline","middle")})});var et=document.getElementById("yearShown");myRange.oninput=function(){et.innerHTML=this.value};
